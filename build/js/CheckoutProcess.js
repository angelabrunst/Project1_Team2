var l=(r,e,t)=>new Promise((i,o)=>{var a=s=>{try{n(t.next(s))}catch(c){o(c)}},h=s=>{try{n(t.throw(s))}catch(c){o(c)}},n=s=>s.done?i(s.value):Promise.resolve(s.value).then(a,h);n((t=t.apply(r,e)).next())});import{getLocalStorage as u}from"./utils.js";import m from"./ExternalServices.js";export default class x{constructor(e,t){this.key=e,this.outputSelector=t,this.list=[],this.itemTotal=0,this.shipping=0,this.tax=0,this.orderTotal=0}init(){this.list=u(this.key),this.calculateItemSummary()}calculateItemSummary(){const e=document.querySelector(this.outputSelector+" #cartTotal"),t=this.list.map(o=>o.FinalPrice);this.itemTotal=t.reduce((o,a)=>o+a),e.innerText="$"+this.itemTotal;const i=document.querySelector(this.outputSelector+" #num-items");i.innerText=this.list.length}calculateOrdertotal(){this.shipping=10+(this.list.length-1)*2,this.tax=(this.itemTotal*.06).toFixed(2),this.orderTotal=(parseFloat(this.itemTotal)+parseFloat(this.shipping)+parseFloat(this.tax)).toFixed(2),this.displayOrderTotals()}displayOrderTotals(){const e=document.querySelector(this.outputSelector+" #shipping"),t=document.querySelector(this.outputSelector+" #tax"),i=document.querySelector(this.outputSelector+" #orderTotal");e.innerText="$"+this.shipping,t.innerText="$"+this.tax,i.innerText="$"+this.orderTotal}checkout(){return l(this,null,function*(){const e=document.forms.checkout,t=d(e);t.orderDate=new Date,t.orderTotal=this.orderTotal,t.tax=this.tax,t.shipping=this.shipping,t.items=T(this.list);try{const i=yield p.checkout(t)}catch(i){}})}}const p=new m;function d(r){const e=new FormData(r),t={};return e.forEach(function(i,o){t[o]=i}),t}function T(r){const e=r.map(t=>({id:t.Id,price:t.FinalPrice,name:t.Name,quantity:1}));return e}
