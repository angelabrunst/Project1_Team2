var o=(m,t,e)=>new Promise((a,r)=>{var l=i=>{try{s(e.next(i))}catch(c){r(c)}},n=i=>{try{s(e.throw(i))}catch(c){r(c)}},s=i=>i.done?a(i.value):Promise.resolve(i.value).then(l,n);s((e=e.apply(m,t)).next())});import{getLocalStorage as h,setLocalStorage as g,alertMessage as y}from"./utils.js";export default class _{constructor(t,e){this.key=t,this.listElement=e,this.total=0,this.totalItems=0,this.newlistElements=[]}init(){return o(this,null,function*(){const t=h(this.key);this.newlistElements=this.newListOfProduct(t),this.calculateListTotal(this.newlistElements),this.renderList(this.newlistElements)})}newListOfProduct(t){let e=t,a=[];for(;e.length>0;){let r=[],l=e[0];r=e.filter(s=>s.Id==l.Id);let n={qty:r.length};Object.assign(l,n),a.push(l),e=e.filter(s=>s.Id!==l.Id)}return a}calculateListTotal(t){const e=t.map(a=>a.FinalPrice*a.qty);this.total=e.reduce((a,r)=>a+r),this.totalItems=t.length}calculateTotalItems(){return this.init(),this.totalItems}renderList(t){this.listElement.innerHTML="",t.forEach(e=>{this.listElement.innerHTML+=`<li class="cart-card divider">
      <a href="#" class="cart-card__image">
        <img src="${e.Images.PrimarySmall}" srcset="${e.Images.PrimaryMedium} 1x, ${e.Images.PrimaryLarge} 2x, ${e.Images.PrimaryExtraLarge} 3x" alt="${e.Name}">
      </a>
      <a href="#">
        <h2 class="card__name">${e.Name}</h2>
      </a>
      <p class="cart-card__color">${e.Colors[0].ColorName}</p>
      <p class="cart-card__quantity">qty: ${e.qty}</p>
      <p class="cart-card__price">$${e.FinalPrice}</p>
      <p class="cart-card__remove" data-id="${e.Id}">X</p>
    </li>`}),document.querySelector(".list-total").innerText+=` $${this.total}`}prepareTemplate(t,e){return t.querySelector(".cart-card__image img").src=e.Images.PrimarySmall,t.querySelector(".cart-card__image img").srcset+=e.Images.PrimaryMedium+" 1x, "+e.Images.PrimaryLarge+" 2x, "+e.Images.PrimaryExtraLarge+" 3x",t.querySelector(".cart-card__image img").alt+=e.Name,t.querySelector(".card__name").textContent=e.Name,t.querySelector(".cart-card__color").textContent=e.Colors[0].ColorName,t.querySelector(".cart-card__price").textContent+=e.FinalPrice,t.querySelector(".cart-card__quantity").textContent="qty: "+e.qty,t.querySelector(".cart-card__remove").id=e.Id,t}removeFromCart(t){if(this.newlistElements.length>0){let e=0,a="";this.newlistElements.some(r=>{if(r.Id===t){a=this.newlistElements[e].NameWithoutBrand,this.newlistElements.splice(e,e+1);return}e++}),g("so-cart",this.newlistElements),y(`${a} removed from cart!`),location.assign("/cart/index")}}}
